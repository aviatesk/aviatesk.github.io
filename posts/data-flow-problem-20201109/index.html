<!DOCTYPE html> <html lang=en > <meta charset=UTF-8  /> <meta name=viewport  content="width=device-width, initial-scale=1" /> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/atom-one-light.min.css"> <link rel=icon  href="/assets/what_about_the_dead_fish.jpeg" /> <link rel=stylesheet  href="/css/aviatesk.css" /> <title>A quick dive into Julia's type inference algorithm</title> <navigation-bar><div class=navigation-info  id=site-info ><a href="/">Shuhei Kadowaki's homepage</a></div></navigation-bar><navigation-bar class=navigation-sticky ><navigation-hover> <a class=navigation-info  id=page-info >$ A quick dive into Julia's type inference algorithm</a> <div class=franklin-toc ><ol><li><a href="#algorithm"> 1. Algorithm</a><li><a href="#implementation"> 2. Implementation</a><li><a href="#compare_with_julias_native_type_inference"> 3. Compare with Julia&#39;s native type inference</a><li><a href="#conclusion"> 4. Conclusion</a><li><a href="#references"> 5. References</a><li><a href="#footnotes"> 6. Footnotes</a></ol></div> </navigation-hover> <navigation-hover> <img src="/assets/terminal.svg" id=terminal-icon  /> <ul id=site-cd > <li><a style="text-decoration: none" href="/">cd ~</a> <li><a style="text-decoration: none" href="/posts">cd posts</a> <li><a style="text-decoration: none" href="https://github.com/aviatesk">cd <i class="fab fa-github"></i></a> <li><a style="text-decoration: none" href="https://twitter.com/kdwkshh">cd <i class="fab fa-twitter"></i></a> <li><a style="text-decoration: none" href="javascript:history.back()">cd ..</a> </ul> </navigation-hover> </navigation-bar> <div class=franklin-content ><div class=blog-info > <blogtitle>A quick dive into Julia's type inference algorithm</blogtitle> <div class=published-date > 09 November 2020 </div> </div> <p>In this article we&#39;ll try to understand and implement a part of <a href="https://julialang.org/">Julia</a>&#39;s inference algorithm. The technique is commonly called as &quot;abstract interpretation&quot; or &quot;data-flow analysis&quot; of a program, which is generally used for program analysis, and so I hope even those who aren&#39;t interested in Julia may enjoy this.</p> <p>In this article we&#39;re going to pick up <a href="https://en.wikipedia.org/wiki/Constant_folding">constant folding propagation</a> as an example data-flow analysis problem, and actually implement it from scratch using Julia. While constant folding propagation is one of the most common compiler optimization technique, the understanding can be easily generalized and the example implementation will help you figure out how Julia&#39;s inference routine works.</p> <div class=franklin-toc ><ol><li><a href="#algorithm">Algorithm</a><ol><li><a href="#data-flow_problem">Data-flow problem</a><li><a href="#a_graph-free_approach_to_data-flow_analysis">&quot;A Graph-Free Approach to Data-Flow Analysis&quot;</a><li><a href="#example_problem_constant_folding_propagation_problem">Example problem: Constant folding propagation problem</a><li><a href="#the_graph-free_algorithm">The graph-free algorithm</a><li><a href="#example_program_prog0_and_example_algorithm_tracing">Example program <code>prog0</code> and example algorithm tracing</a></ol><li><a href="#implementation">Implementation</a><ol><li><a href="#example_problem_constant_folding_propagation_example">Example problem: Constant folding propagation example</a><li><a href="#example_program_prog0">Example program <code>prog0</code></a><li><a href="#the_graph-free_algorithm__2">The graph-free algorithm</a><li><a href="#debugging_the_papers_algorithm">Debugging the paper&#39;s algorithm</a><li><a href="#the_modified_version_of_the_graph-free_algorithm">The modified version of the graph-free algorithm</a></ol><li><a href="#compare_with_julias_native_type_inference">Compare with Julia&#39;s native type inference</a><ol><li><a href="#try_it_first">Try it first</a><li><a href="#check_the_fixes_in_julias_type_inference_implementation">Check the fixes in Julia&#39;s type inference implementation</a></ol><li><a href="#conclusion">Conclusion</a><li><a href="#references">References</a><li><a href="#footnotes">Footnotes</a></ol></div> <h1 id=algorithm ><a href="#algorithm">Algorithm</a></h1> <p>In this section we will briefly introduce some notations to describe a general data-flow analysis and consider the example problem &#40;constant folding propagation&#41;, and finally understand an algorithm to solve it.</p> <h2 id=data-flow_problem ><a href="#data-flow_problem">Data-flow problem</a></h2> <p>A <span class=bibref ><a href="#dataflowprob">data-flow problem</a></span> is defined by the following 4 components:</p> <ol> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><msub><mi>I</mi><mn>0</mn></msub><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><msub><mi>I</mi><mi>n</mi></msub><mo>∈</mo><mtext>Instr</mtext></mrow><annotation encoding="application/x-tex">P = I_0 ... I_n \in \text{Instr}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >.</span><span class=mord >.</span><span class=mord >.</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class=mord >Instr</span></span></span></span></span>: a program, which consists of &quot;instructions&quot;</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mo>&lt;</mo><mi>A</mi><mo separator=true >,</mo><mo>⊔</mo><mo separator=true >,</mo><mo>⊓</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">L = &lt; A, \sqcup, \sqcap &gt;</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">A</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >⊔</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >⊓</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&gt;</span></span></span></span> : <a href="https://en.wikipedia.org/wiki/Lattice_&#40;order&#41;">lattice</a> of abstract state that represent some property of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo><mo>:</mo><mtext>Instr</mtext><mo>→</mo><mo stretchy=false >(</mo><mi>A</mi><mo>→</mo><mi>A</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">![.!] : \text{Instr} \rightarrow (A \rightarrow A)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class=mord >Instr</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class=mclose >)</span></span></span></span>: &quot;abstract semantics&quot; of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, which gives how each instruction acts on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>&#39;s abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>∈</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">a_0 \in A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6891em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>: initial state of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></p> </ol> <p>where:</p> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Instr</mtext></mrow><annotation encoding="application/x-tex">\text{Instr}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class=mord >Instr</span></span></span></span></span>: basic instructions that make up a program; we can think of any kind of instruction as far as we can distinguish between instructions which cause the control flow to branch and those which keep the control flow linear</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>: set that represents program&#39;s state<sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup></p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊔</mo><mo separator=true >,</mo><mo>⊓</mo></mrow><annotation encoding="application/x-tex">\sqcup, \sqcap</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.75em;vertical-align:-0.19444em;"></span><span class=mord >⊔</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >⊓</span></span></span></span>: operations corresponding to <a href="https://en.wikipedia.org/wiki/Join_and_meet">join and meet</a> respectively, that acts on <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span></p> </ul> <p>The actual and concrete definitions of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span> are given for each data-flow problem.</p> <h2 id=a_graph-free_approach_to_data-flow_analysis ><a href="#a_graph-free_approach_to_data-flow_analysis">&quot;A Graph-Free Approach to Data-Flow Analysis&quot;</a></h2> <p><span class=bibref ><a href="#bbgraph">Muchnick, S.S. and Jones, N.D., 1981. Program flow analysis: Theory and applications (Vol. 196)</a></span> proposed an algorithm that uses a graph that has nodes of <a href="https://en.wikipedia.org/wiki/Basic_block">basic blocks</a> &#40;&quot;BB graph&quot;&#41; as a core data structure, and it had been the <em>de facto</em> standard algorithm to solve a data-flow problem.</p> <p><span class=bibref ><a href="#graphfree">Mohnen, M., 2002, April. A graph-free approach to data-flow analysis</a></span> extended that algorithm so that it doesn&#39;t use a graph as an explicit data structure.</p> <p>It experimentally showed that the &quot;graph-free&quot; approach has the following benefits:</p> <ul> <li><p>improved memory efficiency: in many cases, it&#39;s able to reduce the memory usage by a third, at the cost of negligible execution time trade-offs</p> <li><p>easy to implement: it no longer needs to build a BB graph</p> </ul> <p>To help us understand the algorithm proposed in the paper, let&#39;s introduce an example data-flow problem first.</p> <div class=note ><div class=admonition-header >Important note</div> <div class=admonition-body >In the rest of this article, I&#39;m going to refer to <span class=bibref ><a href="#graphfree">Mohnen, M., 2002, April. A graph-free approach to data-flow analysis</a></span> as &quot;the paper&quot;.</div></div> <h2 id=example_problem_constant_folding_propagation_problem ><a href="#example_problem_constant_folding_propagation_problem">Example problem: Constant folding propagation problem</a></h2> <p>This article picks up <a href="https://en.wikipedia.org/wiki/Constant_folding">constant folding propagation</a> as an example data-flow problem. It is a common compiler optimization technique that aims at finding as many constants as possible at compiler time, and replacing the runtime computations with the constant values. So the data-flow problem for that is setup up such that it determines if a variable is constant or not at each point of the program.</p> <p>So let&#39;s get started with defining 1.&#41; program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, 2.&#41; lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>, 3.&#41; abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span>, and 4.&#41; the initial state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p> <h3 id=problem_setting_1_program_p ><a href="#problem_setting_1_program_p">Problem setting 1: Program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></a></h3> <p>For the sake of simplicity, we will assume that the program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> only performs operations on integers and there&#39;re only three type of instruction:</p> <ul> <li><p>assignment: <code>lhs :&#61; rhs</code></p> <li><p>unconditional branching: <code>goto instruction</code></p> <li><p>conditional branching: <code>condition &amp;&amp; goto instruction</code></p> </ul> <h3 id=problem_setting_2_lattice_l ><a href="#problem_setting_2_lattice_l">Problem setting 2: Lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span></a></h3> <p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> to be an abstract value that represents each variable&#39;s property. For constant folding prop&#39;, we only need to consider the following three kinds of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>:</p> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span>: the top element of lattice</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>∈</mo><mi mathvariant=double-struck >N</mi></mrow><annotation encoding="application/x-tex">c \in \mathbb{N}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">c</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68889em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbb">N</span></span></span></span></span>: constant</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span>: the bottom element of lattice</p> </ul> <p>The paper gave intuitive meanings of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span> as follows:</p> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span>: &quot;non constant due to <em>missing information</em>&quot;</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span>: &quot;non constant due to <em>conflict</em>&quot;</p> </ul> <p>Next, we defined the ordering of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> as follows: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>≤</mo><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_1 \le c_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≤</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> iff a&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_1 = c_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, b&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub><mo>=</mo><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">c_1 = \bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span>, c&#41; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub><mo>=</mo><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">c_2 = \top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">c</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span></p> <p>So <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> forms the flat lattice as shown in the following image: <img src="../assets/data-flow-problem-20201109/lattice.png" alt=lattice  /></p> <div class=caption >Hasse diagram of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mi>C</mi><mo separator=true >,</mo><mo>⊔</mo><mo separator=true >,</mo><mo>⊓</mo><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&lt; C, \sqcup, \sqcap &gt; </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >⊔</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >⊓</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&gt;</span></span></span></span></div> <p>The abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> for each instruction of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> can be represented as the following map, where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> is the set of variables in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>A</mi><mo>:</mo><mo>=</mo><mi>X</mi><mo>→</mo><mi>C</mi></mrow><annotation encoding="application/x-tex"> A := X \rightarrow C </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span></span> <p>Finally, we can think of meet an join operations on abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⊓</mo><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">\sqcap_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7055600000000001em;vertical-align:-0.15em;"></span><span class=mord ><span class=mbin >⊓</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⊔</mo><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">\sqcup_A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.7055600000000001em;vertical-align:-0.15em;"></span><span class=mord ><span class=mbin >⊔</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41; as per-variable uses of the corresponding operation on abstract value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>.</p> <h3 id=problem_setting_3_abstract_semantics ><a href="#problem_setting_3_abstract_semantics">Problem setting 3: Abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span></a></h3> <p>Let&#39;s consider the abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span> of program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>. Each instruction of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> has the following effect on abstract state:</p> <ul> <li><p>assignment &#40;<code>lhs :&#61; rhs</code>&#41;: assigns <code>rhs</code> to <code>lhs</code> only when <code>rhs</code> is known to be constant, otherwise assign <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span> to <code>lhs</code></p> <li><p>unconditional branching &#40;<code>goto instruction</code>&#41;: doesn&#39;t change the abstract state</p> <li><p>conditional branching &#40;<code>condition &amp;&amp; goto instruction</code>&#41;: doesn&#39;t change the abstract state</p> </ul> <div class=caption >Abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!] </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span></div> <h3 id=problem_setting_4_initial_program_state_a_0 ><a href="#problem_setting_4_initial_program_state_a_0">Problem setting 4: Initial program state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></a></h3> <p>While the paper explains that the initial state of program in constant folding prop&#39; problem should be initialized with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span>, it&#39;s probably wrong. Rather, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> should be initialized with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span> for this problem; Intuitively, at the initial state, each variable in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> should be interpreted as &quot;non constant due to <em>missing information</em>&quot; rather than &quot;non constant due to <em>conflict</em>&quot;.</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>:</mo><mo>=</mo><mi>X</mi><mo>→</mo><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex"> a_0 := X \rightarrow \top </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span></span> <h2 id=the_graph-free_algorithm ><a href="#the_graph-free_algorithm">The graph-free algorithm</a></h2> <p>Now we&#39;ve set up the data-flow problem. The paper proposed the following algorithm to solve it: <sup id="fnref:2"><a href="#fndef:2" class=fnref >[2]</a></sup></p> <img src="../assets/data-flow-problem-20201109/algorithm.png" alt="the graph-free algorithm" /> <div class=caption >The graph-free algorithm</div> <p>Intuitive understandings of this algorithm are:</p> <ol> <li><p>the program itself acts on its abstract state at instruction level via abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span></p> <li><p>the algorithm works by updating the current program counter <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">pc</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">c</span></span></span></span>, which corresponds to the current instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, and the working set <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>, which holds the rest of the instructions to be computed</p> <li><p>the abstract state of the current instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> propagates to states of all the instructions that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> may reach</p> <li><p>however, the abstract state of the current instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> propagates only if it &quot;changes&quot; the abstract state of an instruction to which it propagates</p> </ol> <p> 3. corresponds to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub><mo>=</mo><mo stretchy=false >(</mo><mtext>if </mtext><mi>ψ</mi><mtext> goto </mtext><mi>l</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">I_{pc} = (\text{if} \psi \text{goto} l)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord text"><span class=mord >if</span></span><span class=mord > </span><span class="mord mathnormal" style="margin-right:0.03588em;">ψ</span><span class=mord > </span><span class="mord text"><span class=mord >goto</span></span><span class=mord > </span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class=mclose >)</span></span></span></span> in the algorithm. This means, the algorithm accounts for both branches at the conditional branching, unlike the actual program execution.</p> <p> 4. corresponds to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>if </mtext><mi>n</mi><mi>e</mi><mi>w</mi><mo>&lt;</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">\text{if} new &lt; s_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord text"><span class=mord >if</span></span><span class=mord > </span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>if </mtext><mi>n</mi><mi>e</mi><mi>w</mi><mo>&lt;</mo><msub><mi>s</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">\text{if} new &lt; s_{l}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord text"><span class=mord >if</span></span><span class=mord > </span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the algorithm. The paper uses the ordering relation <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">&lt;</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class=mrel >&lt;</span></span></span></span> in the lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> of the abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> as the condition to check whether or not he abstract state of the current instruction &quot;changes&quot; the abstract state of an instruction to which it propagates. In other word, if <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>if </mtext><mi>n</mi><mi>e</mi><mi>w</mi><mo>&lt;</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">\text{if} new &lt; s_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord text"><span class=mord >if</span></span><span class=mord > </span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> doesn&#39;t hold we consider the abstract state has &quot;converged&quot; &#40;and finally the algorithm will terminate after all the abstract states for each instruction has converged&#41;. The paper also explains that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">&lt;</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class=mrel >&lt;</span></span></span></span> is equivalent to the following condition:</p> <a id=strict_ordering_relation_between_abstract_states  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi><mo>&lt;</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo>≡</mo><mo stretchy=false >(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo>⊓</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo>=</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy=false >)</mo><mo>∧</mo><mo stretchy=false >(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo mathvariant=normal >≠</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> new &lt; s_{pc&#x27;} \equiv (new \sqcap s_{pc&#x27;} = new) \land (new \ne s_{pc&#x27;}) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7498579999999999em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≡</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊓</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∧</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel ><span class=mrel ><span class="mord vbox"><span class=thinbox ><span class=rlap ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=inner ><span class=mrel ></span></span><span class=fix ></span></span></span></span></span><span class=mrel >=</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></span> <p>That is, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> &#40;abstract state of the current instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>&#41; is propagated to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">s_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> &#40;abstract state of the next instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">I_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.969438em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>&#41; only when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> is lower than <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">s_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> in the lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span><sup id="fnref:3"><a href="#fndef:3" class=fnref >[3]</a></sup>. Thus, the abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> for each instruction is <em>always</em> updated in a way that it transitions towards the bottom of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>, so that this algorithm will always converge given lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> with finite height.</p> <h2 id=example_program_prog0_and_example_algorithm_tracing ><a href="#example_program_prog0_and_example_algorithm_tracing">Example program <code>prog0</code> and example algorithm tracing</a></h2> <p>As an concrete example of the program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>, suppose we have the following program <code>prog0</code>:</p> <pre><code class="julia hljs"><span class=hljs-number >0</span> ─ I₀ <span class=hljs-keyword >=</span> x <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> <span class=hljs-number >1</span>
│   I₁ <span class=hljs-keyword >=</span> y <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> <span class=hljs-number >2</span>
│   I₂ <span class=hljs-keyword >=</span> z <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> <span class=hljs-number >3</span>
└── I₃ <span class=hljs-keyword >=</span> goto I₈
<span class=hljs-number >1</span> ─ I₄ <span class=hljs-keyword >=</span> r <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> y <span class=hljs-built_in >+</span> z
└── I₅ <span class=hljs-keyword >=</span> <span class=hljs-keyword >if</span> x <span class=hljs-built_in >≤</span> z goto I₇
<span class=hljs-number >2</span> ─ I₆ <span class=hljs-keyword >=</span> r <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> z <span class=hljs-built_in >+</span> y
<span class=hljs-number >3</span> ─ I₇ <span class=hljs-keyword >=</span> x <span class=hljs-built_in >:</span><span class=hljs-keyword >=</span> x <span class=hljs-built_in >+</span> <span class=hljs-number >1</span>
<span class=hljs-number >4</span> ─ I₈ <span class=hljs-keyword >=</span> <span class=hljs-keyword >if</span> x <span class=hljs-built_in >&lt;</span> <span class=hljs-number >10</span> goto I₄</code></pre> <div class=caption >Example program: <code>prog0</code></div> <p>&#40;The leftmost numbers correspond to basic blocks. They&#39;re not used by the algorithm presented in this article.&#41;</p> <p>The paper shows the following tables as the example tracing of the algorithm running on <code>prog0</code>: <a id=tracing-example  class=anchor ></a> <img src="../assets/data-flow-problem-20201109/tracing-example.png" alt=tracing-example  /></p> <div class=caption >The paper&#39;s tracing example on <code>@prog0</code></div> <p>We can see that at the final state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>x</mtext><mi mathvariant=normal >/</mi><mi mathvariant=normal >⊥</mi><mtext> y</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> z</mtext><mi mathvariant=normal >/</mi><mn>3</mn><mtext> r</mtext><mi mathvariant=normal >/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">\text{x}/\bot \text{y}/2 \text{z}/3 \text{r}/5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >x</span></span><span class=mord >/</span><span class=mord >⊥</span><span class=mord > </span><span class="mord text"><span class=mord >y</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >z</span></span><span class=mord >/</span><span class=mord >3</span><span class=mord > </span><span class="mord text"><span class=mord >r</span></span><span class=mord >/</span><span class=mord >5</span></span></span></span>&#41;, the algorithm obtains the information that &quot;<code>r</code> is a constant <code>5</code>&quot;, which doesn&#39;t appear in <code>prog0</code>.</p> <h1 id=implementation ><a href="#implementation">Implementation</a></h1> <p>Phew, such a long preface. Now let&#39;s express the data-flow problem and implement the algorithm using Julia &#33; As in the previous section, we first setup the problem, and then tackle the algorithm. The full code can be found at <a href="https://github.com/aviatesk/aviatesk.github.io/blob/main/posts/assets/data-flow-problem-20201109/dataflow.jl">https://github.com/aviatesk/aviatesk.github.io/blob/main/posts/assets/data-flow-problem-20201109/dataflow.jl</a>.</p> <div class=note ><div class=admonition-header >Acknowledgement</div> <div class=admonition-body >The code below was originally adapted from <a href="https://github.com/JeffBezanson/dataflow.jl/blob/c21a6737a8d877c244bef590d207d868f6744d3a/dataflow.jl">https://github.com/JeffBezanson/dataflow.jl/blob/c21a6737a8d877c244bef590d207d868f6744d3a/dataflow.jl</a> under the MIT license.</div></div> <h2 id=example_problem_constant_folding_propagation_example ><a href="#example_problem_constant_folding_propagation_example">Example problem: Constant folding propagation example</a></h2> <h3 id=problem_setting_1_program_p__2 ><a href="#problem_setting_1_program_p__2">Problem setting 1: Program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span></a></h3> <pre><code class="julia hljs"><span class=hljs-keyword >abstract type</span> <span class=hljs-class >Exp</span> <span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Sym</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Exp</span>
    name<span class=hljs-built_in >::</span><span class=hljs-type >Symbol</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Num</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Exp</span>
    val<span class=hljs-built_in >::</span><span class=hljs-type >Int</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Call</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Exp</span>
    head<span class=hljs-built_in >::</span><span class=hljs-type >Sym</span>
    args<span class=hljs-built_in >::</span><span class=hljs-type >Vector{Exp}</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >abstract type</span> <span class=hljs-class >Instr</span> <span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Assign</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Instr</span>
    lhs<span class=hljs-built_in >::</span><span class=hljs-type >Sym</span>
    rhs<span class=hljs-built_in >::</span><span class=hljs-type >Exp</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Goto</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Instr</span>
    label<span class=hljs-built_in >::</span><span class=hljs-type >Int</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >GotoIf</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >Instr</span>
    label<span class=hljs-built_in >::</span><span class=hljs-type >Int</span>
    cond<span class=hljs-built_in >::</span><span class=hljs-type >Exp</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >const</span> Program <span class=hljs-keyword >=</span> <span class=hljs-type >Vector{Instr}</span></code></pre></p> <p><pre><code class="plaintext hljs">Array{Instr,1}</code></pre>
<h3 id=problem_setting_2_lattice_l__2 ><a href="#problem_setting_2_lattice_l__2">Problem setting 2: Lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span></a></h3>
<p>Now we will express the abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>:</mo><mo>=</mo><mi>X</mi><mo>→</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">A := X \rightarrow C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >→</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> of an instruction that composes program <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>.</p>
<p>First, we define <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, abstract value that a variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> can have, and their order: <pre><code class="julia hljs"><span class=hljs-comment ># partial order, meet, join, top, bottom, and their identities</span>

<span class=hljs-keyword >import</span> Base<span class=hljs-built_in >:</span> <span class=hljs-built_in >≤</span>, <span class=hljs-built_in >==</span>, <span class=hljs-built_in >&lt;</span>, show

<span class=hljs-keyword >abstract type</span> <span class=hljs-class >LatticeElement</span> <span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >Const</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >LatticeElement</span>
    val<span class=hljs-built_in >::</span><span class=hljs-type >Int</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >struct</span> <span class=hljs-class >TopElement</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >LatticeElement</span> <span class=hljs-keyword >end</span>
<span class=hljs-keyword >struct</span> <span class=hljs-class >BotElement</span> <span class=hljs-built_in >&lt;:</span> <span class=hljs-type >LatticeElement</span> <span class=hljs-keyword >end</span>

<span class=hljs-keyword >const</span> ⊤ <span class=hljs-keyword >=</span> <span class=hljs-built_in >TopElement</span>()
<span class=hljs-keyword >const</span> ⊥ <span class=hljs-keyword >=</span> <span class=hljs-built_in >BotElement</span>()

<span class=hljs-title >show</span>(<span class=hljs-params >io</span><span class=hljs-built_in >::</span><span class=hljs-type >IO</span>, <span class=hljs-built_in >::</span><span class=hljs-type >TopElement</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >print</span>(io, <span class=hljs-string >&#x27;⊤&#x27;</span>)
<span class=hljs-title >show</span>(<span class=hljs-params >io</span><span class=hljs-built_in >::</span><span class=hljs-type >IO</span>, <span class=hljs-built_in >::</span><span class=hljs-type >BotElement</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >print</span>(io, <span class=hljs-string >&#x27;⊥&#x27;</span>)

<span class=hljs-title >≤</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>, <span class=hljs-params >y</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >≡</span>y
<span class=hljs-title >≤</span>(<span class=hljs-built_in >::</span><span class=hljs-type >BotElement</span>,      <span class=hljs-built_in >::</span><span class=hljs-type >TopElement</span>)      <span class=hljs-keyword >=</span> <span class=hljs-literal >true</span>
<span class=hljs-title >≤</span>(<span class=hljs-built_in >::</span><span class=hljs-type >BotElement</span>,      <span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>)  <span class=hljs-keyword >=</span> <span class=hljs-literal >true</span>
<span class=hljs-title >≤</span>(<span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>,  <span class=hljs-built_in >::</span><span class=hljs-type >TopElement</span>)      <span class=hljs-keyword >=</span> <span class=hljs-literal >true</span>

<span class=hljs-comment ># NOTE: == and &lt; are defined such that future LatticeElements only need to implement ≤</span>
<span class=hljs-built_in >==</span>(x<span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>, y<span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >≤</span>y <span class=hljs-keyword >&amp;&amp;</span> y<span class=hljs-built_in >≤</span>x
<span class=hljs-built_in >&lt;</span>(x<span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>,  y<span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >≤</span>y <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-built_in >!</span>(y<span class=hljs-built_in >≤</span>x)

<span class=hljs-comment ># join</span>
<span class=hljs-title >⊔</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>, <span class=hljs-params >y</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >≤</span>y <span class=hljs-built_in >?</span> y <span class=hljs-built_in >:</span> y<span class=hljs-built_in >≤</span>x <span class=hljs-built_in >?</span> x <span class=hljs-built_in >:</span> ⊤

<span class=hljs-comment ># meet</span>
<span class=hljs-title >⊓</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>, <span class=hljs-params >y</span><span class=hljs-built_in >::</span><span class=hljs-type >LatticeElement</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >≤</span>y <span class=hljs-built_in >?</span> x <span class=hljs-built_in >:</span> y<span class=hljs-built_in >≤</span>x <span class=hljs-built_in >?</span> y <span class=hljs-built_in >:</span> ⊥</code></pre></p>
<p><pre><code class="plaintext hljs">⊓ (generic function with 1 method)</code></pre></p>
<p>Next, let&#39;s represent abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> as map from variable <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span> to its abstract value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, and define its ordering relation <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding="application/x-tex">&lt;</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class=mrel >&lt;</span></span></span></span>: <pre><code class="julia hljs"><span class=hljs-comment ># NOTE: the paper (https://api.semanticscholar.org/CorpusID:28519618) uses U+1D56E MATHEMATICAL BOLD FRAKTUR CAPITAL C for this</span>
<span class=hljs-keyword >const</span> AbstractState <span class=hljs-keyword >=</span> <span class=hljs-type >Dict{Symbol,LatticeElement}</span>

<span class=hljs-comment ># extend lattices of abstract values to lattices of mappings of variables to abstract values;</span>
<span class=hljs-comment ># ⊓ and ⊔ operate pair-wise, and from there we can just rely on the Base implementation for</span>
<span class=hljs-comment ># dictionary equality comparison</span>

<span class=hljs-title >⊔</span>(<span class=hljs-params >X</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>, <span class=hljs-params >Y</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >AbstractState</span>( v <span class=hljs-built_in >=&gt;</span> X[v] <span class=hljs-built_in >⊔</span> Y[v] <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> <span class=hljs-built_in >keys</span>(X) )
<span class=hljs-title >⊓</span>(<span class=hljs-params >X</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>, <span class=hljs-params >Y</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >AbstractState</span>( v <span class=hljs-built_in >=&gt;</span> X[v] <span class=hljs-built_in >⊓</span> Y[v] <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> <span class=hljs-built_in >keys</span>(X) )

<span class=hljs-built_in >&lt;</span>(X<span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>, Y<span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>) <span class=hljs-keyword >=</span> X<span class=hljs-built_in >⊓</span>Y<span class=hljs-built_in >==</span>X <span class=hljs-keyword >&amp;&amp;</span> X<span class=hljs-built_in >≠</span>Y</code></pre></p>
<p><pre><code class="plaintext hljs">&lt; (generic function with 78 methods)</code></pre></p>
<h3 id=problem_setting_3_abstract_semantics__2 ><a href="#problem_setting_3_abstract_semantics__2">Problem setting 3: Abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span></a></h3>
<p>Abstract semantics <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >!</mo><mo stretchy=false >[</mo><mi mathvariant=normal >.</mi><mo stretchy=false >!</mo><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">![.!]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mclose >!</span><span class=mopen >[</span><span class=mord >.</span><span class=mclose >!</span><span class=mclose >]</span></span></span></span> can be easily implemented using Julia&#39;s actual code execution. We can retrieve the actual arithmetic method from <code>head::Symbol</code> field of <code>Call</code> object using <a href="https://docs.julialang.org/en/v1/base/base/#Core.getfield"><code>getfield</code></a>.</p>
<pre><code class="julia hljs"><span class=hljs-title >abstract_eval</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >Num</span>, <span class=hljs-params >s</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >Const</span>(x<span class=hljs-built_in >.</span>val)

<span class=hljs-title >abstract_eval</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >Sym</span>, <span class=hljs-params >s</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>) <span class=hljs-keyword >=</span> <span class=hljs-built_in >get</span>(s, x<span class=hljs-built_in >.</span>name, ⊥)

<span class=hljs-keyword >function </span><span class=hljs-title >abstract_eval</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >Call</span>, <span class=hljs-params >s</span><span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>)
    f <span class=hljs-keyword >=</span> <span class=hljs-built_in >getfield</span>(<span class=hljs-meta >@__MODULE__</span>, x<span class=hljs-built_in >.</span>head<span class=hljs-built_in >.</span>name)

    argvals <span class=hljs-keyword >=</span> <span class=hljs-type >Int</span>[]
    <span class=hljs-keyword >for</span> arg <span class=hljs-keyword >in</span> x<span class=hljs-built_in >.</span>args
        arg <span class=hljs-keyword >=</span> <span class=hljs-built_in >abstract_eval</span>(arg, s)
        arg <span class=hljs-built_in >===</span> ⊥ <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> ⊥ <span class=hljs-comment ># bail out if any of call arguments is non-constant</span>
        <span class=hljs-built_in >push!</span>(argvals, <span class=hljs-built_in >unwrap_val</span>(arg))
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> <span class=hljs-built_in >Const</span>(<span class=hljs-built_in >f</span>(argvals<span class=hljs-built_in >.</span><span class=hljs-built_in >.</span><span class=hljs-built_in >.</span>))
<span class=hljs-keyword >end</span>

<span class=hljs-comment ># unwrap our lattice representation into actual Julia value</span>
<span class=hljs-title >unwrap_val</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >Num</span>)   <span class=hljs-keyword >=</span> x<span class=hljs-built_in >.</span>val
<span class=hljs-title >unwrap_val</span>(<span class=hljs-params >x</span><span class=hljs-built_in >::</span><span class=hljs-type >Const</span>) <span class=hljs-keyword >=</span> x<span class=hljs-built_in >.</span>val</code></pre></p>
<p><pre><code class="plaintext hljs">unwrap_val (generic function with 2 methods)</code></pre>
<h3 id=problem_setting_4_initial_program_state_a_0__2 ><a href="#problem_setting_4_initial_program_state_a_0__2">Problem setting 4: Initial program state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></a></h3>
<p>We modify the example in the article and initialize <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span>: <pre><code class="julia hljs">a₀ <span class=hljs-keyword >=</span> <span class=hljs-built_in >AbstractState</span>(<span class=hljs-symbol >:x</span> <span class=hljs-built_in >=&gt;</span> ⊤, <span class=hljs-symbol >:y</span> <span class=hljs-built_in >=&gt;</span> ⊤, <span class=hljs-symbol >:z</span> <span class=hljs-built_in >=&gt;</span> ⊤, <span class=hljs-symbol >:r</span> <span class=hljs-built_in >=&gt;</span> ⊤)</code></pre></p>
<p><pre><code class="plaintext hljs">Dict{Symbol,LatticeElement} with 4 entries:
  :y =&gt; ⊤
  :z =&gt; ⊤
  :r =&gt; ⊤
  :x =&gt; ⊤</code></pre></p>
<h2 id=example_program_prog0 ><a href="#example_program_prog0">Example program <code>prog0</code></a></h2>
<p>Before implementing the algorithm, let&#39;s represent the example program <code>prog0</code> first.</p>
<p>An naive representation would look like this: <pre><code class="julia hljs">prog0 <span class=hljs-keyword >=</span> [<span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:x</span>), <span class=hljs-built_in >Num</span>(<span class=hljs-number >1</span>)),                              <span class=hljs-comment ># I₀</span>
         <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:y</span>), <span class=hljs-built_in >Num</span>(<span class=hljs-number >2</span>)),                              <span class=hljs-comment ># I₁</span>
         <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:z</span>), <span class=hljs-built_in >Num</span>(<span class=hljs-number >3</span>)),                              <span class=hljs-comment ># I₂</span>
         <span class=hljs-built_in >Goto</span>(<span class=hljs-number >8</span>),                                              <span class=hljs-comment ># I₃</span>
         <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:r</span>), <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-built_in >:</span>(<span class=hljs-built_in >+</span>)), [<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:y</span>), <span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:z</span>)])), <span class=hljs-comment ># I₄</span>
         <span class=hljs-built_in >GotoIf</span>(<span class=hljs-number >7</span>, <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-built_in >:</span>(<span class=hljs-built_in >≤</span>)), [<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:x</span>), <span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:z</span>)])),       <span class=hljs-comment ># I₅</span>
         <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:r</span>), <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-built_in >:</span>(<span class=hljs-built_in >+</span>)), [<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:z</span>), <span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:y</span>)])), <span class=hljs-comment ># I₆</span>
         <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:x</span>), <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-built_in >:</span>(<span class=hljs-built_in >+</span>)), [<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:x</span>), <span class=hljs-built_in >Num</span>(<span class=hljs-number >1</span>)])),  <span class=hljs-comment ># I₇</span>
         <span class=hljs-built_in >GotoIf</span>(<span class=hljs-number >4</span>, <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Sym</span>(<span class=hljs-built_in >:</span>(<span class=hljs-built_in >&lt;</span>)), [<span class=hljs-built_in >Sym</span>(<span class=hljs-symbol >:x</span>), <span class=hljs-built_in >Num</span>(<span class=hljs-number >10</span>)])),       <span class=hljs-comment ># I₈</span>
         ]<span class=hljs-built_in >::</span><span class=hljs-type >Program</span></code></pre></p>
<p><pre><code class="plaintext hljs">9-element Array{Instr,1}:
 Assign(Sym(:x), Num(1))
 Assign(Sym(:y), Num(2))
 Assign(Sym(:z), Num(3))
 Goto(8)
 Assign(Sym(:r), Call(Sym(:+), Exp[Sym(:y), Sym(:z)]))
 GotoIf(7, Call(Sym(:≤), Exp[Sym(:x), Sym(:z)]))
 Assign(Sym(:r), Call(Sym(:+), Exp[Sym(:z), Sym(:y)]))
 Assign(Sym(:x), Call(Sym(:+), Exp[Sym(:x), Num(1)]))
 GotoIf(4, Call(Sym(:&lt;), Exp[Sym(:x), Num(10)]))</code></pre></p>
<p>Hm, it&#39;s a little clumsy. So, let&#39;s write a macro <code>@prog</code> that generates our target instruction-level problem <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> from Julia syntax, using Julia&#39;s powerful meta-programming features<sup id="fnref:4"><a href="#fndef:4" class=fnref >[4]</a></sup>. We&#39;ll use <a href="https://github.com/FluxML/MacroTools.jl">MacroTools.jl</a>, a package for pattern-matching on Julia&#39;s <a href="https://docs.julialang.org/en/v1/devdocs/ast/#Surface-syntax-AST">surface syntax AST</a>.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> MacroTools

<span class=hljs-keyword >macro</span> <span class=hljs-built_in >prog</span>(blk)
    Instr[<span class=hljs-built_in >Instr</span>(x) <span class=hljs-keyword >for</span> x <span class=hljs-keyword >in</span> <span class=hljs-built_in >filter</span>(<span class=hljs-built_in >!</span>islnn, blk<span class=hljs-built_in >.</span>args)]<span class=hljs-built_in >::</span><span class=hljs-type >Program</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function </span><span class=hljs-title >Instr</span>(<span class=hljs-params >x</span>)
    <span class=hljs-keyword >if</span> <span class=hljs-meta >@capture</span>(x, lhs_ <span class=hljs-keyword >=</span> rhs_)               <span class=hljs-comment ># =&gt; Assign</span>
        <span class=hljs-built_in >Assign</span>(<span class=hljs-built_in >Instr</span>(lhs), <span class=hljs-built_in >Instr</span>(rhs))
    <span class=hljs-keyword >elseif</span> <span class=hljs-meta >@capture</span>(x, <span class=hljs-meta >@goto</span> label_)          <span class=hljs-comment ># =&gt; Goto</span>
        <span class=hljs-built_in >Goto</span>(label)
    <span class=hljs-keyword >elseif</span> <span class=hljs-meta >@capture</span>(x, cond_ <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> label_) <span class=hljs-comment ># =&gt; GotoIf</span>
        <span class=hljs-built_in >GotoIf</span>(label, <span class=hljs-built_in >Instr</span>(cond))
    <span class=hljs-keyword >elseif</span> <span class=hljs-meta >@capture</span>(x, <span class=hljs-built_in >f_</span>(args__))            <span class=hljs-comment ># =&gt; Call</span>
        <span class=hljs-built_in >Call</span>(<span class=hljs-built_in >Instr</span>(f), <span class=hljs-built_in >Instr</span><span class=hljs-built_in >.</span>(args))
    <span class=hljs-keyword >elseif</span> <span class=hljs-built_in >isa</span>(x, <span class=hljs-type >Symbol</span>)                     <span class=hljs-comment ># =&gt; Sym</span>
        <span class=hljs-built_in >Sym</span>(x)
    <span class=hljs-keyword >elseif</span> <span class=hljs-built_in >isa</span>(x, <span class=hljs-type >Int</span>)                        <span class=hljs-comment ># =&gt; Num</span>
        <span class=hljs-built_in >Num</span>(x)
    <span class=hljs-keyword >else</span>
        <span class=hljs-built_in >error</span>(<span class=hljs-string >&quot;invalid expression: <span class=hljs-subst >$(x)</span>&quot;</span>)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>

<span class=hljs-title >islnn</span>(<span class=hljs-meta >@nospecialize</span>(<span class=hljs-params >_</span>)) <span class=hljs-keyword >=</span> <span class=hljs-literal >false</span>
<span class=hljs-title >islnn</span>(<span class=hljs-built_in >::</span><span class=hljs-type >LineNumberNode</span>) <span class=hljs-keyword >=</span> <span class=hljs-literal >true</span></code></pre></p>
<p><pre><code class="plaintext hljs">islnn (generic function with 2 methods)</code></pre>
<p>Now we can generate <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> directly from Julia&#39;s nice syntax :-&#41; <pre><code class="julia hljs">prog0 <span class=hljs-keyword >=</span> <span class=hljs-meta >@prog</span> <span class=hljs-keyword >begin</span>
    x <span class=hljs-keyword >=</span> <span class=hljs-number >1</span>             <span class=hljs-comment ># I₀</span>
    y <span class=hljs-keyword >=</span> <span class=hljs-number >2</span>             <span class=hljs-comment ># I₁</span>
    z <span class=hljs-keyword >=</span> <span class=hljs-number >3</span>             <span class=hljs-comment ># I₂</span>
    <span class=hljs-meta >@goto</span> <span class=hljs-number >8</span>           <span class=hljs-comment ># I₃</span>
    r <span class=hljs-keyword >=</span> y <span class=hljs-built_in >+</span> z         <span class=hljs-comment ># I₄</span>
    x <span class=hljs-built_in >≤</span> z <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >7</span>  <span class=hljs-comment ># I₅</span>
    r <span class=hljs-keyword >=</span> z <span class=hljs-built_in >+</span> y         <span class=hljs-comment ># I₆</span>
    x <span class=hljs-keyword >=</span> x <span class=hljs-built_in >+</span> <span class=hljs-number >1</span>         <span class=hljs-comment ># I₇</span>
    x <span class=hljs-built_in >&lt;</span> <span class=hljs-number >10</span> <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >4</span> <span class=hljs-comment ># I₈</span>
<span class=hljs-keyword >end</span></code></pre></p>
<p><pre><code class="plaintext hljs">9-element Array{Instr,1}:
 Assign(Sym(:x), Num(1))
 Assign(Sym(:y), Num(2))
 Assign(Sym(:z), Num(3))
 Goto(8)
 Assign(Sym(:r), Call(Sym(:+), Exp[Sym(:y), Sym(:z)]))
 GotoIf(7, Call(Sym(:≤), Exp[Sym(:x), Sym(:z)]))
 Assign(Sym(:r), Call(Sym(:+), Exp[Sym(:z), Sym(:y)]))
 Assign(Sym(:x), Call(Sym(:+), Exp[Sym(:x), Num(1)]))
 GotoIf(4, Call(Sym(:&lt;), Exp[Sym(:x), Num(10)]))</code></pre></p>
<h2 id=the_graph-free_algorithm__2 ><a href="#the_graph-free_algorithm__2">The graph-free algorithm</a></h2>
<p>Okay, it&#39;s time to implement the main algorithm. If we try to implement it faithfully according to the paper, it would look like this: <pre><code class="julia hljs"><span class=hljs-keyword >function </span><span class=hljs-title >max_fixed_point</span>(<span class=hljs-params >prog</span><span class=hljs-built_in >::</span><span class=hljs-type >Program</span>, <span class=hljs-params >a</span>₀<span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>, <span class=hljs-params >eval</span>)
    n <span class=hljs-keyword >=</span> <span class=hljs-built_in >length</span>(prog)
    init <span class=hljs-keyword >=</span> <span class=hljs-built_in >AbstractState</span>( v <span class=hljs-built_in >=&gt;</span> ⊤ <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> <span class=hljs-built_in >keys</span>(a₀) )
    s <span class=hljs-keyword >=</span> [ a₀; [ init <span class=hljs-keyword >for</span> i <span class=hljs-keyword >=</span> <span class=hljs-number >2</span><span class=hljs-built_in >:</span>n ] ]
    W <span class=hljs-keyword >=</span> <span class=hljs-built_in >BitSet</span>(<span class=hljs-number >0</span><span class=hljs-built_in >:</span>n<span class=hljs-built_in >-</span><span class=hljs-number >1</span>)

    <span class=hljs-keyword >while</span> <span class=hljs-built_in >!</span><span class=hljs-built_in >isempty</span>(W)
        pc <span class=hljs-keyword >=</span> <span class=hljs-built_in >first</span>(W)
        <span class=hljs-keyword >while</span> pc <span class=hljs-built_in >≠</span> n
            <span class=hljs-built_in >delete!</span>(W, pc)
            I <span class=hljs-keyword >=</span> prog[pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
            new <span class=hljs-keyword >=</span> s[pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
            <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, Assign)
                <span class=hljs-comment ># for an assignment, outgoing value is different from incoming</span>
                new <span class=hljs-keyword >=</span> <span class=hljs-built_in >copy</span>(new)
                new[I<span class=hljs-built_in >.</span>lhs<span class=hljs-built_in >.</span>name] <span class=hljs-keyword >=</span> <span class=hljs-built_in >eval</span>(I<span class=hljs-built_in >.</span>rhs, new)
            <span class=hljs-keyword >end</span>

            <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, Goto)
                pc´ <span class=hljs-keyword >=</span> I<span class=hljs-built_in >.</span>label
            <span class=hljs-keyword >else</span>
                pc´ <span class=hljs-keyword >=</span> pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>
                <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, GotoIf)
                    l <span class=hljs-keyword >=</span> I<span class=hljs-built_in >.</span>label
                    <span class=hljs-keyword >if</span> new <span class=hljs-built_in >&lt;</span> s[l<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                        <span class=hljs-built_in >push!</span>(W, l)
                        s[l<span class=hljs-built_in >+</span><span class=hljs-number >1</span>] <span class=hljs-keyword >=</span> new
                    <span class=hljs-keyword >end</span>
                <span class=hljs-keyword >end</span>
            <span class=hljs-keyword >end</span>
            <span class=hljs-keyword >if</span> pc´<span class=hljs-built_in >≤</span>n<span class=hljs-built_in >-</span><span class=hljs-number >1</span> <span class=hljs-keyword >&amp;&amp;</span> new <span class=hljs-built_in >&lt;</span> s[pc´<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                s[pc´<span class=hljs-built_in >+</span><span class=hljs-number >1</span>] <span class=hljs-keyword >=</span> new
                pc <span class=hljs-keyword >=</span> pc´
            <span class=hljs-keyword >else</span>
                pc <span class=hljs-keyword >=</span> n
            <span class=hljs-keyword >end</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> s
<span class=hljs-keyword >end</span></code></pre></p>
<p><pre><code class="plaintext hljs">max_fixed_point (generic function with 1 method)</code></pre></p>
<p>Note that in this article we&#39;re trying to express things in the same way as the paper as possible, and so here we&#39;ve adjusted the paper&#39;s <code>0</code>-based indexing so that it fits with Julia&#39;s <code>1</code>-based indexing as <code>s&#91;pc´&#43;1&#93;</code> and so on.</p>
<p>Now we&#39;re good to go, let&#39;s run it on <code>prog0</code> &#33;</p>
<pre><code class="julia hljs"><span class=hljs-built_in >max_fixed_point</span>(prog0, a₀, abstract_eval)</code></pre></p>
<p><pre><code class="plaintext hljs">9-element Array{Dict{Symbol,LatticeElement},1}:
 Dict(:y =&gt; ⊤,:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; ⊤)
 Dict(:y =&gt; ⊤,:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; ⊤,:x =&gt; Const(1))</code></pre>
<p>... Hmm ? The result is different from <a href="#tracing-example">the paper&#39;s tracing example</a>. See the last line <code>Dict&#40;:y &#61;&gt; Const&#40;2&#41;, :z &#61;&gt; Const&#40;3&#41;, :r &#61;&gt; ⊤, :x &#61;&gt; Const&#40;1&#41;&#41;</code>, which corresponds to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the tracing example, and there&#39;s no longer any information that indicates <code>r</code> is a constant <code>5</code> at that point.</p>
<p>To say the conclusion first, this is in fact because the paper&#39;s original algorithm is partially wrong<sup id="fnref:5"><a href="#fndef:5" class=fnref >[5]</a></sup>. Let&#39;s take a close look.</p>
<p>Actually, the tracing example from the paper is incomplete. If we run the algorithm, at the cell at the 5th row from the top and 11th column from the left, which is blank in the original table, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">s_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;the state of <code>I₃ &#61; goto I₈</code>&#41; should have propagated to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;the state of <code>I₈ &#61; if x &lt; 10 goto I₄</code>&#41;, and so the cell should have been <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub><mo>:</mo><mo>=</mo><mtext>x</mtext><mi mathvariant=normal >/</mi><mn>1</mn><mtext> y</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> z</mtext><mi mathvariant=normal >/</mi><mn>3</mn><mtext> r</mtext><mi mathvariant=normal >/</mi><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">s_8 := \text{x}/1 \text{y}/2 \text{z}/3 \text{r}/\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >x</span></span><span class=mord >/</span><span class=mord >1</span><span class=mord > </span><span class="mord text"><span class=mord >y</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >z</span></span><span class=mord >/</span><span class=mord >3</span><span class=mord > </span><span class="mord text"><span class=mord >r</span></span><span class=mord >/</span><span class=mord >⊤</span></span></span></span>. Then at the cell at 11th row from the top and 10th column from the left, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub><mo>&lt;</mo><msub><mi>s</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">s_8 &lt; s_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6891em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> no longer holds, and thus <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">s_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;the state of <code>I₇ &#61; x :&#61; x &#43; 1</code>&#41; won&#39;t be propagated to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span> will be emptied, and consequently, the algorithm will terminate at that point.</p>
<p>Since the implementation above faithfully follows the paper, it terminated as exactly as described above &#40;i.e. <code>new &lt; s&#91;pc´&#43;1&#93;</code> didn&#39;t returns <code>true</code> when <code>new</code> is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">s_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41;. Now we&#39;re in trouble ...</p>
<h2 id=debugging_the_papers_algorithm ><a href="#debugging_the_papers_algorithm">Debugging the paper&#39;s algorithm</a></h2>
<p>The problem with the paper&#39;s algorithm is that, to put it simply, the states can&#39;t propagate well if we use strict ordering relation between abstract states <span class=eqref >(<a href="#strict_ordering_relation_between_abstract_states">3</a>)</span> to determine whether or not the abstract state of the current instruction changes an abstract state to which it propagates.</p>
<p>In this particular case, while the ordering relation <code>new &lt; s&#91;pc´&#43;1&#93;</code> doesn&#39;t hold where <code>s&#91;pc´&#43;1&#93;</code> is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;abstract state of the next instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">I_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>x</mtext><mi mathvariant=normal >/</mi><mn>1</mn><mtext> y</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> z</mtext><mi mathvariant=normal >/</mi><mn>3</mn><mtext> r</mtext><mi mathvariant=normal >/</mi><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\text{x}/1 \text{y}/2 \text{z}/3 \text{r}/\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >x</span></span><span class=mord >/</span><span class=mord >1</span><span class=mord > </span><span class="mord text"><span class=mord >y</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >z</span></span><span class=mord >/</span><span class=mord >3</span><span class=mord > </span><span class="mord text"><span class=mord >r</span></span><span class=mord >/</span><span class=mord >⊤</span></span></span></span>&#41; and <code>new &#61; s&#91;pc´&#93;</code> is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">s_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;abstract state of the current instruction <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">I_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>x</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> y</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> z</mtext><mi mathvariant=normal >/</mi><mn>3</mn><mtext> r</mtext><mi mathvariant=normal >/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">\text{x}/2 \text{y}/2 \text{z}/3 \text{r}/5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >x</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >y</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >z</span></span><span class=mord >/</span><span class=mord >3</span><span class=mord > </span><span class="mord text"><span class=mord >r</span></span><span class=mord >/</span><span class=mord >5</span></span></span></span>&#41;, but we still want to propagate <code>new</code> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">s_7</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41; to <code>s&#91;pc´&#43;1&#93;</code> &#40;<span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>&#41; and update <code>s&#91;pc´&#43;1&#93;</code> to such an new state that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub><mo>:</mo><mo>=</mo><mtext>x</mtext><mi mathvariant=normal >/</mi><mi mathvariant=normal >⊥</mi><mtext> y</mtext><mi mathvariant=normal >/</mi><mn>2</mn><mtext> z</mtext><mi mathvariant=normal >/</mi><mn>3</mn><mtext> r</mtext><mi mathvariant=normal >/</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">s_8 := \text{x}/\bot \text{y}/2 \text{z}/3 \text{r}/5</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.36687em;vertical-align:0em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >x</span></span><span class=mord >/</span><span class=mord >⊥</span><span class=mord > </span><span class="mord text"><span class=mord >y</span></span><span class=mord >/</span><span class=mord >2</span><span class=mord > </span><span class="mord text"><span class=mord >z</span></span><span class=mord >/</span><span class=mord >3</span><span class=mord > </span><span class="mord text"><span class=mord >r</span></span><span class=mord >/</span><span class=mord >5</span></span></span></span>.</p>
<p>Therefore, we want to fix the original algorithm so that:</p>
<ol>
<li><p>it propagates changes in the current instruction&#39;s state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> to the next instruction&#39;s state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub></mrow><annotation encoding="application/x-tex">s_{pc&#x27;}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>, <em>without</em> using their strict ordering relation <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi><mo>&lt;</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo>≡</mo><mo stretchy=false >(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo>⊓</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo>=</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy=false >)</mo><mo>∧</mo><mo stretchy=false >(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo mathvariant=normal >≠</mo><msub><mi>s</mi><mrow><mi>p</mi><msup><mi>c</mi><mo mathvariant=normal  lspace=0em  rspace=0em >′</mo></msup></mrow></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">new &lt; s_{pc&#x27;} \equiv (new \sqcap s_{pc&#x27;} = new) \land (new \ne s_{pc&#x27;})</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.7498579999999999em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≡</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊓</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.716668em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∧</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel ><span class=mrel ><span class="mord vbox"><span class=thinbox ><span class=rlap ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class=inner ><span class=mrel ></span></span><span class=fix ></span></span></span></span></span><span class=mrel >=</span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.036108em;vertical-align:-0.286108em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32798em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6828285714285715em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class=pstrut  style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span> <span class=eqref >(<a href="#strict_ordering_relation_between_abstract_states">3</a>)</span></p>

<li><p>on the other hand, in order to keep the convergence of the algorithm, changes in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> should be propagated in a way that <em>the new state always is lower in the lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> than the previous state</em></p>

</ol>
<p>We can put them into code as follows:</p>
<ol>
<li><p>use the &quot;equivalence&quot; of abstract state to determine whether or not the abstract state of the current instruction changes an abstract state to which it propagates</p>

<li><p>use <code>⊓</code> &#40;meet, computes maximum lower bound&#41; to update abstract state, to make sure that the updated abstract state will be lower in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> than the previous state.</p>

</ol>
<p>So, let&#39;s apply the following diff to <code>max_fixed_point</code>:</p>
<pre><code class="diff hljs"><span class=hljs-comment >--- a/dataflow.jl</span>
<span class=hljs-comment >+++ b/dataflow.jl</span>
@@ -156,14 +156,14 @@ function max_fixed_point(prog::Program, a₀::AbstractState, eval)
                 pc´ = pc+1
                 if isa(I, GotoIf)
                     l = I.label
<span class=hljs-deletion >-                    if new &lt; s[l+1]</span>
<span class=hljs-addition >+                    if new ≠ s[l+1]</span>
                         push!(W, l)
<span class=hljs-deletion >-                        s[l+1] = new</span>
<span class=hljs-addition >+                        s[l+1] = new ⊓ s[l+1]</span>
                     end
                 end
             end
<span class=hljs-deletion >-            if pc´≤n-1 &amp;&amp; new &lt; s[pc´+1]</span>
<span class=hljs-deletion >-                s[pc´+1] = new</span>
<span class=hljs-addition >+            if pc´≤n-1 &amp;&amp; new ≠ s[pc´+1]</span>
<span class=hljs-addition >+                s[pc´+1] = new ⊓ s[pc´+1]</span>
                 pc = pc´
             else
                 pc = n</code></pre>
<h2 id=the_modified_version_of_the_graph-free_algorithm ><a href="#the_modified_version_of_the_graph-free_algorithm">The modified version of the graph-free algorithm</a></h2>
<p>Let&#39;s try the modified version of the algorithm: <pre><code class="julia hljs"><span class=hljs-comment ># NOTE: in this problem, we make sure that states will always move to _lower_ position in lattice, so</span>
<span class=hljs-comment ># - initialize states with `⊤`</span>
<span class=hljs-comment ># - we use `⊓` (meet) operator to update states,</span>
<span class=hljs-comment ># - and the condition we use to check whether or not the statement makes a change is `new ≠ prev`</span>
<span class=hljs-keyword >function </span><span class=hljs-title >max_fixed_point</span>(<span class=hljs-params >prog</span><span class=hljs-built_in >::</span><span class=hljs-type >Program</span>, <span class=hljs-params >a</span>₀<span class=hljs-built_in >::</span><span class=hljs-type >AbstractState</span>, <span class=hljs-params >eval</span>)
    n <span class=hljs-keyword >=</span> <span class=hljs-built_in >length</span>(prog)
    init <span class=hljs-keyword >=</span> <span class=hljs-built_in >AbstractState</span>( v <span class=hljs-built_in >=&gt;</span> ⊤ <span class=hljs-keyword >for</span> v <span class=hljs-keyword >in</span> <span class=hljs-built_in >keys</span>(a₀) )
    s <span class=hljs-keyword >=</span> [ a₀; [ init <span class=hljs-keyword >for</span> i <span class=hljs-keyword >=</span> <span class=hljs-number >2</span><span class=hljs-built_in >:</span>n ] ]
    W <span class=hljs-keyword >=</span> <span class=hljs-built_in >BitSet</span>(<span class=hljs-number >0</span><span class=hljs-built_in >:</span>n<span class=hljs-built_in >-</span><span class=hljs-number >1</span>)

    <span class=hljs-keyword >while</span> <span class=hljs-built_in >!</span><span class=hljs-built_in >isempty</span>(W)
        pc <span class=hljs-keyword >=</span> <span class=hljs-built_in >first</span>(W)
        <span class=hljs-keyword >while</span> pc <span class=hljs-built_in >≠</span> n
            <span class=hljs-built_in >delete!</span>(W, pc)
            I <span class=hljs-keyword >=</span> prog[pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
            new <span class=hljs-keyword >=</span> s[pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
            <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, Assign)
                <span class=hljs-comment ># for an assignment, outgoing value is different from incoming</span>
                new <span class=hljs-keyword >=</span> <span class=hljs-built_in >copy</span>(new)
                new[I<span class=hljs-built_in >.</span>lhs<span class=hljs-built_in >.</span>name] <span class=hljs-keyword >=</span> <span class=hljs-built_in >eval</span>(I<span class=hljs-built_in >.</span>rhs, new)
            <span class=hljs-keyword >end</span>

            <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, Goto)
                pc´ <span class=hljs-keyword >=</span> I<span class=hljs-built_in >.</span>label
            <span class=hljs-keyword >else</span>
                pc´ <span class=hljs-keyword >=</span> pc<span class=hljs-built_in >+</span><span class=hljs-number >1</span>
                <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(I, GotoIf)
                    l <span class=hljs-keyword >=</span> I<span class=hljs-built_in >.</span>label
                    <span class=hljs-keyword >if</span> new <span class=hljs-built_in >≠</span> s[l<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                        <span class=hljs-built_in >push!</span>(W, l)
                        s[l<span class=hljs-built_in >+</span><span class=hljs-number >1</span>] <span class=hljs-keyword >=</span> new <span class=hljs-built_in >⊓</span> s[l<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                    <span class=hljs-keyword >end</span>
                <span class=hljs-keyword >end</span>
            <span class=hljs-keyword >end</span>
            <span class=hljs-keyword >if</span> pc´<span class=hljs-built_in >≤</span>n<span class=hljs-built_in >-</span><span class=hljs-number >1</span> <span class=hljs-keyword >&amp;&amp;</span> new <span class=hljs-built_in >≠</span> s[pc´<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                s[pc´<span class=hljs-built_in >+</span><span class=hljs-number >1</span>] <span class=hljs-keyword >=</span> new <span class=hljs-built_in >⊓</span> s[pc´<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]
                pc <span class=hljs-keyword >=</span> pc´
            <span class=hljs-keyword >else</span>
                pc <span class=hljs-keyword >=</span> n
            <span class=hljs-keyword >end</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> s
<span class=hljs-keyword >end</span>

<span class=hljs-built_in >max_fixed_point</span>(prog0, a₀, abstract_eval) <span class=hljs-comment ># The solution contains the `:r =&gt; Const(5)`, which is not found in the program</span></code></pre></p>
<p><pre><code class="plaintext hljs">9-element Array{Dict{Symbol,LatticeElement},1}:
 Dict(:y =&gt; ⊤,:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; ⊤)
 Dict(:y =&gt; ⊤,:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; ⊤,:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; ⊤,:x =&gt; Const(1))
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; ⊥)
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; ⊥)
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; ⊥)
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; ⊥)
 Dict(:y =&gt; Const(2),:z =&gt; Const(3),:r =&gt; Const(5),:x =&gt; ⊥)</code></pre></p>
<p>Hooray &#33; Splendidly, the algorithm&#39;s returned <code>Dict&#40;:y &#61;&gt; Const&#40;2&#41;, :z &#61;&gt; Const&#40;3&#41;, :r &#61;&gt; Const&#40;5&#41;, :x &#61;&gt; ⊥&#41;</code>, which corresponds to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">s_8</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, and now we know <code>r</code> is a constant <code>5</code> correctly.</p>
<h1 id=compare_with_julias_native_type_inference ><a href="#compare_with_julias_native_type_inference">Compare with Julia&#39;s native type inference</a></h1>
<p>By the way, Julia&#39;s type inference consists of two major parts:</p>
<ul>
<li><p>part 1. local inference within the scope of a function</p>

<li><p>part 2. inter-procedural inference across function calls</p>

</ul>
<p>The part 1 is the core subroutine of Julia&#39;s type inference process and is based on the algorithm proposed in <span class=bibref ><a href="#graphfree">Mohnen, M., 2002, April. A graph-free approach to data-flow analysis</a></span>, that we now know how it works. The part 2 extends it so that the inference still converges even when it recurs into a function calls in the inter-procedural way &#40;even if there is mutual recursive calls, etc.&#41;. This article won&#39;t go any further on the part 2, please refer to <span class=bibref ><a href="#phdthesis">Jeff Bezanson's Ph.D. thesis</a></span> or <span class=bibref ><a href="#blogbost">Jameson Nash's blog post</a></span> for details if interested.</p>
<p>So we may be interested in if Julia’s type inference also modifies the paper&#39;s original algorithm as well as this article. For example, does it work for <code>prog0</code> correctly ?</p>
<h2 id=try_it_first ><a href="#try_it_first">Try it first</a></h2>
<p>Julia&#39;s type inference routine uses data-flow analysis to type-annotate your Julia code in order to generate efficient code. It actually does constant prop&#39; to improve the accuracy of inference. So if Julia&#39;s type inference routine works correctly, it should reveal that <code>r</code> in <code>prog0</code> is a constant <code>5</code>.</p>
<p>Let&#39;s create Julia code corresponding to <code>prog0</code> and run type inference on it. We can express <code>prog0</code> as Julia code using <a href="https://docs.julialang.org/en/v1/base/base/#Base.@label"><code>@label</code></a> macro:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >begin</span>
    <span class=hljs-keyword >begin</span>
        <span class=hljs-meta >@label</span> I₀
        x <span class=hljs-keyword >=</span> <span class=hljs-number >1</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-built_in >.</span><span class=hljs-built_in >.</span><span class=hljs-built_in >.</span>
    <span class=hljs-keyword >begin</span>
        <span class=hljs-meta >@label</span> I₅
        x <span class=hljs-built_in >≤</span> z <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> I₇
    <span class=hljs-keyword >end</span>
    <span class=hljs-built_in >.</span><span class=hljs-built_in >.</span><span class=hljs-built_in >.</span>
<span class=hljs-keyword >end</span></code></pre>
<p>Again, it&#39;s a bit ugly, so let&#39;s define <code>@prog′</code> macro that generates valid Julia code from our <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><msub><mi>I</mi><mn>0</mn></msub><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><mi mathvariant=normal >.</mi><msub><mi>I</mi><mi>n</mi></msub><mo>∈</mo><mtext>Instr</mtext></mrow><annotation encoding="application/x-tex">P = I_0 ... I_n \in \text{Instr}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord >.</span><span class=mord >.</span><span class=mord >.</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class=mord >Instr</span></span></span></span></span> notations &#40;i.e. the syntax <code>@prog</code> works on&#41;: <pre><code class="julia hljs"><span class=hljs-comment ># generate valid Julia code from the &quot;`Instr` syntax&quot;</span>
<span class=hljs-keyword >macro</span> <span class=hljs-built_in >prog′</span>(blk)
    prog′ <span class=hljs-keyword >=</span> <span class=hljs-built_in >Expr</span>(<span class=hljs-symbol >:block</span>)
    bns <span class=hljs-keyword >=</span> [<span class=hljs-built_in >gensym</span>(<span class=hljs-built_in >Symbol</span>(<span class=hljs-symbol >:instruction</span>, i<span class=hljs-built_in >-</span><span class=hljs-number >1</span>)) <span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span><span class=hljs-built_in >:</span><span class=hljs-built_in >length</span>(blk<span class=hljs-built_in >.</span>args)] <span class=hljs-comment ># pre-generate labels for all instructions</span>

    <span class=hljs-keyword >for</span> (i,x) <span class=hljs-keyword >in</span> <span class=hljs-built_in >enumerate</span>(<span class=hljs-built_in >filter</span>(<span class=hljs-built_in >!</span>islnn, blk<span class=hljs-built_in >.</span>args))
        x <span class=hljs-keyword >=</span> MacroTools<span class=hljs-built_in >.</span><span class=hljs-built_in >postwalk</span>(x) <span class=hljs-keyword >do</span> x
            <span class=hljs-keyword >return</span> <span class=hljs-keyword >if</span> <span class=hljs-meta >@capture</span>(x, <span class=hljs-meta >@goto</span> label_)
                <span class=hljs-built_in >Expr</span>(<span class=hljs-symbol >:symbolicgoto</span>, bns[label<span class=hljs-built_in >+</span><span class=hljs-number >1</span>]) <span class=hljs-comment ># fix `@goto i` into valid goto syntax</span>
            <span class=hljs-keyword >else</span>
                x
            <span class=hljs-keyword >end</span>
        <span class=hljs-keyword >end</span>

        <span class=hljs-built_in >push!</span>(prog′<span class=hljs-built_in >.</span>args, <span class=hljs-built_in >Expr</span>(<span class=hljs-symbol >:block</span>, <span class=hljs-built_in >Expr</span>(<span class=hljs-symbol >:symboliclabel</span>, bns[i]), x)) <span class=hljs-comment ># label this statement</span>
    <span class=hljs-keyword >end</span>

    <span class=hljs-keyword >return</span> prog′
<span class=hljs-keyword >end</span>

<span class=hljs-meta >@macroexpand</span> <span class=hljs-meta >@prog′</span> <span class=hljs-keyword >begin</span>
    x <span class=hljs-keyword >=</span> <span class=hljs-number >1</span>             <span class=hljs-comment ># I₀</span>
    y <span class=hljs-keyword >=</span> <span class=hljs-number >2</span>             <span class=hljs-comment ># I₁</span>
    z <span class=hljs-keyword >=</span> <span class=hljs-number >3</span>             <span class=hljs-comment ># I₂</span>
    <span class=hljs-meta >@goto</span> <span class=hljs-number >8</span>           <span class=hljs-comment ># I₃</span>
    r <span class=hljs-keyword >=</span> y <span class=hljs-built_in >+</span> z         <span class=hljs-comment ># I₄</span>
    x <span class=hljs-built_in >≤</span> z <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >7</span>  <span class=hljs-comment ># I₅</span>
    r <span class=hljs-keyword >=</span> z <span class=hljs-built_in >+</span> y         <span class=hljs-comment ># I₆</span>
    x <span class=hljs-keyword >=</span> x <span class=hljs-built_in >+</span> <span class=hljs-number >1</span>         <span class=hljs-comment ># I₇</span>
    x <span class=hljs-built_in >&lt;</span> <span class=hljs-number >10</span> <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >4</span> <span class=hljs-comment ># I₈</span>
<span class=hljs-keyword >end</span></code></pre></p>
<p><pre><code class="plaintext hljs">quote
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#40###instruction0#265&quot;)))
        var&quot;#52#x&quot; = 1
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#41###instruction1#266&quot;)))
        var&quot;#49#y&quot; = 2
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#42###instruction2#267&quot;)))
        var&quot;#50#z&quot; = 3
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#43###instruction3#268&quot;)))
        $(Expr(:symbolicgoto, Symbol(&quot;#44###instruction8#273&quot;)))
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#45###instruction4#269&quot;)))
        var&quot;#51#r&quot; = var&quot;#49#y&quot; + var&quot;#50#z&quot;
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#46###instruction5#270&quot;)))
        var&quot;#52#x&quot; ≤ var&quot;#50#z&quot; &amp;&amp; $(Expr(:symbolicgoto, Symbol(&quot;#47###instruction7#272&quot;)))
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#48###instruction6#271&quot;)))
        var&quot;#51#r&quot; = var&quot;#50#z&quot; + var&quot;#49#y&quot;
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#47###instruction7#272&quot;)))
        var&quot;#52#x&quot; = var&quot;#52#x&quot; + 1
    end
    begin
        $(Expr(:symboliclabel, Symbol(&quot;#44###instruction8#273&quot;)))
        var&quot;#52#x&quot; &lt; 10 &amp;&amp; $(Expr(:symbolicgoto, Symbol(&quot;#45###instruction4#269&quot;)))
    end
end</code></pre></p>
<p>As we can see <code>@prog′</code> nicely generates valid Julia code corresponding to <code>prog0</code> from our notation :&#41;</p>
<p>Okay, let&#39;s check the result of Julia&#39;s native type inference using <a href="https://docs.julialang.org/en/v1/base/base/#Base.code_typed"><code>code_typed</code></a>: <pre><code class="julia hljs"><span class=hljs-built_in >code_typed</span>(; optimize <span class=hljs-keyword >=</span> <span class=hljs-literal >false</span>) <span class=hljs-keyword >do</span>
    <span class=hljs-meta >@prog′</span> <span class=hljs-keyword >begin</span>
        x <span class=hljs-keyword >=</span> <span class=hljs-number >1</span>             <span class=hljs-comment ># I₀</span>
        y <span class=hljs-keyword >=</span> <span class=hljs-number >2</span>             <span class=hljs-comment ># I₁</span>
        z <span class=hljs-keyword >=</span> <span class=hljs-number >3</span>             <span class=hljs-comment ># I₂</span>
        <span class=hljs-meta >@goto</span> <span class=hljs-number >8</span>           <span class=hljs-comment ># I₃</span>
        r <span class=hljs-keyword >=</span> y <span class=hljs-built_in >+</span> z         <span class=hljs-comment ># I₄</span>
        x <span class=hljs-built_in >≤</span> z <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >7</span>  <span class=hljs-comment ># I₅</span>
        r <span class=hljs-keyword >=</span> z <span class=hljs-built_in >+</span> y         <span class=hljs-comment ># I₆</span>
        x <span class=hljs-keyword >=</span> x <span class=hljs-built_in >+</span> <span class=hljs-number >1</span>         <span class=hljs-comment ># I₇</span>
        x <span class=hljs-built_in >&lt;</span> <span class=hljs-number >10</span> <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >4</span> <span class=hljs-comment ># I₈</span>

        x, y, z, r <span class=hljs-comment ># to check the result of abstract interpretation</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span> <span class=hljs-built_in >|</span><span class=hljs-built_in >&gt;</span> first</code></pre></p>
<p><pre><code class="plaintext hljs">CodeInfo(
1 ─       Core.NewvarNode(:(r))::Any
│         (x = 1)::Core.Compiler.Const(1, false)
│         (y = 2)::Core.Compiler.Const(2, false)
│         (z = 3)::Core.Compiler.Const(3, false)
└──       goto #6
2 ─       (r = y::Core.Compiler.Const(2, false) + z::Core.Compiler.Const(3, false))::Core.Compiler.Const(5, false)
│   %7  = (x ≤ z::Core.Compiler.Const(3, false))::Bool
└──       goto #4 if not %7
3 ─       goto #5
4 ─       (r = z::Core.Compiler.Const(3, false) + y::Core.Compiler.Const(2, false))::Core.Compiler.Const(5, false)
5 ┄       (x = x + 1)::Int64
6 ┄ %12 = (x &lt; 10)::Bool
└──       goto #8 if not %12
7 ─       goto #2
8 ─ %15 = Core.tuple(x, y::Core.Compiler.Const(2, false), z::Core.Compiler.Const(3, false), r::Core.Compiler.Const(5, false))::Core.Compiler.PartialStruct(NTuple{4,Int64}, Any[Int64, Core.Compiler.Const(2, false), Core.Compiler.Const(3, false), Core.Compiler.Const(5, false)])
└──       return %15
) =&gt; NTuple{4,Int64}</code></pre></p>
<p>As seen in the line <code>8 ─ &#37;15 &#61; Core.tuple&#40;x, y::Core.Const&#40;2&#41;, z::Core.Const&#40;3&#41;, r::Core.Const&#40;5&#41;&#41;::Core.PartialStruct&#40;NTuple&#123;4, Int64&#125;, Any&#91;Int64, Core.Const&#40;2&#41;, Core.Const&#40;3&#41;, Core.Const&#40;5&#41;&#93;&#41;</code>, Julia&#39;s data-flow analysis correctly reveals that <code>r</code> is a constant <code>5</code> &#40;i.e. <code>r::Core.Const&#40;5&#41;</code> in Julia&#39;s internal representation&#41;.</p>
<div class=collapsible ><div class=collapsible-header >Run it actually</div>
<div class=collapsible-content ><p>If we actually execute <code>prog0</code>, we get the result <code>r &#61;&#61; 5</code> as expected: <pre><code class="julia hljs"><span class=hljs-meta >@prog′</span> <span class=hljs-keyword >begin</span>
    x <span class=hljs-keyword >=</span> <span class=hljs-number >1</span>             <span class=hljs-comment ># I₀</span>
    y <span class=hljs-keyword >=</span> <span class=hljs-number >2</span>             <span class=hljs-comment ># I₁</span>
    z <span class=hljs-keyword >=</span> <span class=hljs-number >3</span>             <span class=hljs-comment ># I₂</span>
    <span class=hljs-meta >@goto</span> <span class=hljs-number >8</span>           <span class=hljs-comment ># I₃</span>
    r <span class=hljs-keyword >=</span> y <span class=hljs-built_in >+</span> z         <span class=hljs-comment ># I₄</span>
    x <span class=hljs-built_in >≤</span> z <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >7</span>  <span class=hljs-comment ># I₅</span>
    r <span class=hljs-keyword >=</span> z <span class=hljs-built_in >+</span> y         <span class=hljs-comment ># I₆</span>
    x <span class=hljs-keyword >=</span> x <span class=hljs-built_in >+</span> <span class=hljs-number >1</span>         <span class=hljs-comment ># I₇</span>
    x <span class=hljs-built_in >&lt;</span> <span class=hljs-number >10</span> <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-meta >@goto</span> <span class=hljs-number >4</span> <span class=hljs-comment ># I₈</span>

    x, y, z, r <span class=hljs-comment ># to check the result of actual execution</span>
<span class=hljs-keyword >end</span></code></pre></p>
<p><pre><code class="plaintext hljs">(10, 2, 3, 5)</code></pre></p></div></div>
<h2 id=check_the_fixes_in_julias_type_inference_implementation ><a href="#check_the_fixes_in_julias_type_inference_implementation">Check the fixes in Julia&#39;s type inference implementation</a></h2>
<p>So Julia&#39;s type inference correctly works on <code>prog0</code>, and now we&#39;re interested in how it&#39;s different from the original algorithm of the paper. Let&#39;s have a quick dive into Julia&#39;s type inference implementation.</p>
<p>To help you understand, I&#39;m going to present the parts in Julia&#39;s data-flow analysis implementation that correspond to the fixes we&#39;ve made in this article:</p>
<blockquote>
<ol>
<li><p>use the &quot;equivalence&quot; of abstract state to determine whether or not the abstract state of the current instruction changes an abstract state to which it propagates</p>

<li><p>use <code>⊓</code> &#40;meet, computes maximum lower bound&#41; to update abstract state, to make sure that the updated abstract state will be lower in <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> than the previous state.</p>

</ol>
</blockquote>
<div class=caption >The fixes we&#39;ve made</div>
<p>Please keep in mind that there&#39;re two notable differences between our constant folding prop&#39; problem and Julia&#39;s type inference:</p>
<ol>
<li><p>our constant folding prop&#39; compares abstract state <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> to determine the convergence of state, while Julia&#39;s type inference compares abstract value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> &#40;, which corresponds to <code>LatticeElement</code> in our implementation&#41;</p>

<li><p>Julia&#39;s type inference and our constant folding prop&#39; works on their own lattice in the opposite directions; unlike our constant folding prop&#39; setup, Julia&#39;s type inference transitions abstract value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>  <em>from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span></em><sup id="fnref:6"><a href="#fndef:6" class=fnref >[6]</a></sup></p>

</ol>
<div class=warning ><div class=admonition-header >Maybe outdated</div>
<div class=admonition-body >The code I&#39;m going to show or refer to was all take from <a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd">this commit</a> of JuliaLang/julia repository.</div></div>
<h3 id=fix_1_the_condition_to_determine_the_convergence_of_abstract_state ><a href="#fix_1_the_condition_to_determine_the_convergence_of_abstract_state">Fix 1: The condition to determine the convergence of abstract state</a></h3>
<p>In Julia&#39;s type inference implementation, <a href="https://github.com/JuliaLang/julia/blob/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/abstractinterpretation.jl#L1260-L1438"><code>typeinf_local</code></a> corresponds to the paper&#39;s algorithm. Within <code>typeinf_local</code>, update of abstract value is done in the following parts:</p>
<ol>
<li><p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/abstractinterpretation.jl#L1316">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/abstractinterpretation.jl#L1316</a>: <code>newstate_else &#61; stupdate&#33;&#40;s&#91;l&#93;, changes_else&#41;</code></p>

<li><p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/abstractinterpretation.jl#L1415">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/abstractinterpretation.jl#L1415</a>: <code>newstate &#61; stupdate&#33;&#40;s&#91;pc´&#93;, changes&#41;</code></p>

</ol>
<p>Here is how <code>stupdate&#33;</code> is implemented:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >function </span><span class=hljs-title >stupdate!</span>(<span class=hljs-params >state</span><span class=hljs-built_in >::</span><span class=hljs-type >VarTable</span>, <span class=hljs-params >changes</span><span class=hljs-built_in >::</span><span class=hljs-type >StateUpdate</span>)
    <span class=hljs-keyword >if</span> <span class=hljs-built_in >!</span><span class=hljs-built_in >isa</span>(changes<span class=hljs-built_in >.</span>var, Slot)
        <span class=hljs-keyword >return</span> <span class=hljs-built_in >stupdate!</span>(state, changes<span class=hljs-built_in >.</span>state)
    <span class=hljs-keyword >end</span>
    newstate <span class=hljs-keyword >=</span> <span class=hljs-literal >false</span>
    changeid <span class=hljs-keyword >=</span> <span class=hljs-built_in >slot_id</span>(changes<span class=hljs-built_in >.</span>var<span class=hljs-built_in >::</span><span class=hljs-type >Slot</span>)
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >=</span> <span class=hljs-number >1</span><span class=hljs-built_in >:</span><span class=hljs-built_in >length</span>(state)
        <span class=hljs-keyword >if</span> i <span class=hljs-built_in >==</span> changeid
            newtype <span class=hljs-keyword >=</span> changes<span class=hljs-built_in >.</span>vtype
        <span class=hljs-keyword >else</span>
            newtype <span class=hljs-keyword >=</span> changes<span class=hljs-built_in >.</span>state[i]
        <span class=hljs-keyword >end</span>
        oldtype <span class=hljs-keyword >=</span> state[i]
        <span class=hljs-comment ># remove any Conditional for this Slot from the vtable</span>
        <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(newtype, VarState)
            newtypetyp <span class=hljs-keyword >=</span> newtype<span class=hljs-built_in >.</span>typ
            <span class=hljs-keyword >if</span> <span class=hljs-built_in >isa</span>(newtypetyp, Conditional) <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-built_in >slot_id</span>(newtypetyp<span class=hljs-built_in >.</span>var) <span class=hljs-built_in >==</span> changeid
                newtype <span class=hljs-keyword >=</span> <span class=hljs-built_in >VarState</span>(<span class=hljs-built_in >widenconditional</span>(newtypetyp), newtype<span class=hljs-built_in >.</span><span class=hljs-literal >undef</span>)
            <span class=hljs-keyword >end</span>
        <span class=hljs-keyword >end</span>
        <span class=hljs-keyword >if</span> <span class=hljs-built_in >schanged</span>(newtype, oldtype)
            newstate <span class=hljs-keyword >=</span> state
            state[i] <span class=hljs-keyword >=</span> <span class=hljs-built_in >smerge</span>(oldtype, newtype)
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> newstate
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function </span><span class=hljs-title >stupdate!</span>(<span class=hljs-params >state</span><span class=hljs-built_in >::</span><span class=hljs-type >VarTable</span>, <span class=hljs-params >changes</span><span class=hljs-built_in >::</span><span class=hljs-type >VarTable</span>)
    newstate <span class=hljs-keyword >=</span> <span class=hljs-literal >false</span>
    <span class=hljs-keyword >for</span> i <span class=hljs-keyword >=</span> <span class=hljs-number >1</span><span class=hljs-built_in >:</span><span class=hljs-built_in >length</span>(state)
        newtype <span class=hljs-keyword >=</span> changes[i]
        oldtype <span class=hljs-keyword >=</span> state[i]
        <span class=hljs-keyword >if</span> <span class=hljs-built_in >schanged</span>(newtype, oldtype)
            newstate <span class=hljs-keyword >=</span> state
            state[i] <span class=hljs-keyword >=</span> <span class=hljs-built_in >smerge</span>(oldtype, newtype)
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >return</span> newstate
<span class=hljs-keyword >end</span></code></pre>
<div class=caption ><blockquote>
<p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L268-L307">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L268-L307</a></p>
</blockquote></div>
<p><code>schanged</code> seems to take the role to determine the convergence of abstract value. Let&#39;s take a closer look at <code>schanged</code>:</p>
<pre><code class="julia hljs"><span class=hljs-meta >@inline</span> <span class=hljs-title >schanged</span>(<span class=hljs-meta >@nospecialize</span>(<span class=hljs-params >n</span>), <span class=hljs-meta >@nospecialize</span>(o)) <span class=hljs-keyword >=</span> (n <span class=hljs-built_in >!==</span> o) <span class=hljs-keyword >&amp;&amp;</span> (o <span class=hljs-built_in >===</span> NOT_FOUND <span class=hljs-keyword >||</span> (n <span class=hljs-built_in >!==</span> NOT_FOUND <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-built_in >!</span><span class=hljs-built_in >issubstate</span>(n, o)))</code></pre>
<div class=caption ><blockquote>
<p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L236">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L236</a></p>
</blockquote></div>
<pre><code class="julia hljs"><span class=hljs-title >issubstate</span>(<span class=hljs-params >a</span><span class=hljs-built_in >::</span><span class=hljs-type >VarState</span>, <span class=hljs-params >b</span><span class=hljs-built_in >::</span><span class=hljs-type >VarState</span>) <span class=hljs-keyword >=</span> (a<span class=hljs-built_in >.</span>typ <span class=hljs-built_in >⊑</span> b<span class=hljs-built_in >.</span>typ <span class=hljs-keyword >&amp;&amp;</span> a<span class=hljs-built_in >.</span><span class=hljs-literal >undef</span> <span class=hljs-built_in >&lt;=</span> b<span class=hljs-built_in >.</span><span class=hljs-literal >undef</span>)</code></pre>
<div class=caption ><blockquote>
<p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L224">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L224</a></p>
</blockquote></div>
<p>where <a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L115-L186"><code>⊑</code></a> computes the partial order of abstract values in Julia&#39;s type lattice.</p>
<p>Comparing to our setup, updating state on <code>schanged&#40;n, o&#41;</code> corresponds to using <code>&#33;&#40;new ≥ s&#91;pc´&#43;1&#93;&#41;</code> instead of <code>new &lt; s&#91;pc´&#43;1&#93;</code> in our code<sup id="fnref:7"><a href="#fndef:7" class=fnref >[7]</a></sup>. In our setup <code>new</code> is actually never higher than <code>s&#91;pc´&#43;1&#93;</code>, thus <code>&#33;&#40;new ≥ s&#91;pc´&#43;1&#93;&#41;</code> in turn equals to <code>new ≠ s&#91;pc´&#43;1&#93;</code>.</p>
<p>Well, as I said, <code>schanged</code> works on abstract <em>values</em> rather than abstract <em>states</em>, unlike <code>≠&#40;::AbstractState, ::AbstractState&#41;</code> in our constant folding prop&#39; setup. But there is no essential difference between them, since our constant folding prop&#39; implementation updates abstract states by variable-wise use of <code>⊓</code> and so <code>≠&#40;::AbstractState, ::AbstractState&#41;</code> returns <code>false</code> only after all abstract values for each variable have converged to their fixed point.</p>
<p>Anyway, we can see Julia&#39;s type inference analysis implementation also changes the paper&#39;s original convergence condition, and uses <code>&#33;⊑</code> instead of <code>⊐</code> as our <code>max_fixed_point</code> uses <code>≠</code> instead of <code>&lt;</code>.</p>
<h3 id=fix_2_how_to_update_abstract_state ><a href="#fix_2_how_to_update_abstract_state">Fix 2: How to update abstract state</a></h3>
<p><code>smerge</code> updates abstract value:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >function </span><span class=hljs-title >smerge</span>(<span class=hljs-params >sa</span><span class=hljs-built_in >::</span><span class=hljs-type >Union{NotFound,VarState}</span>, <span class=hljs-params >sb</span><span class=hljs-built_in >::</span><span class=hljs-type >Union{NotFound,VarState}</span>)
    sa <span class=hljs-built_in >===</span> sb <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> sa
    sa <span class=hljs-built_in >===</span> NOT_FOUND <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> sb
    sb <span class=hljs-built_in >===</span> NOT_FOUND <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> sa
    <span class=hljs-built_in >issubstate</span>(sa, sb) <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> sb
    <span class=hljs-built_in >issubstate</span>(sb, sa) <span class=hljs-keyword >&amp;&amp;</span> <span class=hljs-keyword >return</span> sa
    <span class=hljs-keyword >return</span> <span class=hljs-built_in >VarState</span>(<span class=hljs-built_in >tmerge</span>(sa<span class=hljs-built_in >.</span>typ, sb<span class=hljs-built_in >.</span>typ), sa<span class=hljs-built_in >.</span><span class=hljs-literal >undef</span> <span class=hljs-built_in >|</span> sb<span class=hljs-built_in >.</span><span class=hljs-literal >undef</span>)
<span class=hljs-keyword >end</span></code></pre>
<div class=caption ><blockquote>
<p><a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L226-L233">https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelattice.jl#L226-L233</a></p>
</blockquote></div>
<p>Although <code>smerge</code> looks a bit involved, <code>tmerge</code> seems to be taking the heavy lifting to update abstract values. <a href="https://github.com/JuliaLang/julia/tree/f2eb09e5da50128af1f2b20a451dadd3adc991fd/base/compiler/typelimits.jl#L284-L448"><code>tmerge</code> is yet more complex</a> and so I&#39;d like to omit its detail here, but it basically performs the operation that is equivalent to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊔</mo></mrow><annotation encoding="application/x-tex">\sqcup</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.55556em;vertical-align:0em;"></span><span class=mord >⊔</span></span></span></span> &#40;meet&#41;, which also corresponds to our fix <sup id="fnref:8"><a href="#fndef:8" class=fnref >[8]</a></sup>.</p>
<p>After all, Julia&#39;s type inference implementation bases on the algorithm in the paper but at the same time it also fixes the originally proposed algorithm as this article&#39;s constant folding prop&#39; implementation.</p>
<h1 id=conclusion ><a href="#conclusion">Conclusion</a></h1>
<p>In this article, we have implemented the data-flow analysis algorithm proposed in <span class=bibref ><a href="#graphfree">Mohnen, M., 2002, April. A graph-free approach to data-flow analysis</a></span>, that Julia&#39;s type inference routine is based on. While implementing the example data-flow problem, we found some minor &#40;but super annoying &#33;&#41; mistakes in the paper, and we saw there&#39;re similar changes done in Julia&#39;s type inference implementation; maybe the problems and fixes are only noticed by the readers of this article and the developers of Julia&#39;s compiler.</p>
<p>Well, it&#39;s the very first time for me to doubt and correct an academic paper; it actually took me a fair amount of time to get to this conclusion. <a href="https://akawashiro.github.io/">Akira Kawata</a> struggled with the paper together with me and helped me find and fix the problems. I would like to thank him again here.</p>
<h1 id=references ><a href="#references">References</a></h1>
<ul>
<li><p><a id=dataflowprob  class=anchor ></a><strong>Cousot, P.</strong> and <strong>Cousot, R.</strong>, 1977, January. <a href="https://doi.org/10.1145/512950.512973"><em>Abstract interpretation: a unified lattice model for static analysis of programs by construction or approximation of fixpoints</em></a>. In Proceedings of the 4th ACM SIGACT-SIGPLAN symposium on Principles of programming languages &#40;pp. 238-252&#41;.</p>

<li><p><a id=bbgraph  class=anchor ></a><strong>Muchnick, S.S.</strong> and <strong>Jones, N.D.</strong>, 1981. <a href="https://www.researchgate.net/publication/220689271_Program_Flow_Analysis_Theory_and_Applications"><em>Program flow analysis: Theory and applications &#40;Vol. 196&#41;</em></a>. Englewood Cliffs, New Jersey: Prentice-Hall.</p>

<li><p><a id=graphfree  class=anchor ></a><strong>Mohnen, M.</strong>, 2002, April. <a href="https://www.semanticscholar.org/paper/A-Graph-Free-Approach-to-Data-Flow-Analysis-Mohnen/5ad8cb6b477793ffb5ec29dde89df6b82dbb6dba?p2df"><em>A graph-free approach to data-flow analysis</em></a>. In International Conference on Compiler Construction &#40;pp. 46-61&#41;. Springer, Berlin, Heidelberg.</p>

<li><p><a id=phdthesis  class=anchor ></a><strong>Bezanson, J.W.</strong>, 2015. <a href="https://dspace.mit.edu/handle/1721.1/99811"><em>Abstraction in technical computing</em></a> &#40;Doctoral dissertation, Massachusetts Institute of Technology&#41;.</p>

<li><p><a id=blogbost  class=anchor ></a><strong>Nash, J.</strong>, 2017. <em>Inference Convergence Algorithm in Julia - Revisited</em>. Julia Computing.  &#91;online&#93; juliacomputing.com. Available at: <a href="https://juliacomputing.com/blog/2017/05/inference-converage2/">https://juliacomputing.com/blog/2017/05/inference-converage2/</a> &#91;Accessed 3 November 2020&#93;</p>

</ul>
<h1 id=footnotes ><a href="#footnotes">Footnotes</a></h1>
<p><table class=fndef  id="fndef:1">
    <tr>
        <td class=fndef-backref ><a href="#fnref:1">[1]</a>
        <td class=fndef-content >The paper uses <a href="https://www.compart.com/en/unicode/U&#43;1D56E">Unicode Character &quot;Lu_1D56E&quot; &#40;U&#43;1D56E&#41;</a> as a symbol for this, but in this article we&#39;ll use <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> instead of it since the character isn&#39;t supported by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>a</mi><mi>T</mi><mi>e</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">KaTeX</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>
    
</table>
<table class=fndef  id="fndef:2">
    <tr>
        <td class=fndef-backref ><a href="#fnref:2">[2]</a>
        <td class=fndef-content >Of course this algorithm can be used for general data-flow problems other than the constant folding propagation problem we&#39;ve setup so far, but note that the initial state and inequalities in the algorithm can be different for each problem.
    
</table>
<table class=fndef  id="fndef:3">
    <tr>
        <td class=fndef-backref ><a href="#fnref:3">[3]</a>
        <td class=fndef-content >For conditional branching instruction, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> is propagated to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">s_l</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> &#40;abstract state of conditional jump destination instruction&#41; only when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow><annotation encoding="application/x-tex">new</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> is lower than <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">s_l</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">s</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> in the the lattice <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span>
    
</table>
<table class=fndef  id="fndef:4">
    <tr>
        <td class=fndef-backref ><a href="#fnref:4">[4]</a>
        <td class=fndef-content >As an alternative, we can overload <a href="https://docs.julialang.org/en/v1/manual/conversion-and-promotion/"><code>Base.convert</code></a> and eliminates uses of constructors of <code>Sym</code> and <code>Num</code> by automatically promoting <code>Symbol</code> to <code>Sym</code> and <code>Int</code> to <code>Num</code>. A resulting code with this approach would look more like the code with our first naive approach to write <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> than the code with <code>@prog</code> macro.
    
</table>
<table class=fndef  id="fndef:5">
    <tr>
        <td class=fndef-backref ><a href="#fnref:5">[5]</a>
        <td class=fndef-content >By the way, there is no errata about this &#33;
    
</table>
<table class=fndef  id="fndef:6">
    <tr>
        <td class=fndef-backref ><a href="#fnref:6">[6]</a>
        <td class=fndef-content >Julia&#39;s type inference routine works on such a lattice that the more abstract types are at the top and the more concrete types are at the bottom &#40;where the most abstract type is <code>Any</code> and the most concrete type is <code>Union&#123;&#125;</code>&#41;, and transitions abstract value from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span> &#40;, which is why Julia&#39;s type inference returns <code>Any</code> when it can&#39;t determine the type&#41;.
    
</table>
<table class=fndef  id="fndef:7">
    <tr>
        <td class=fndef-backref ><a href="#fnref:7">[7]</a>
        <td class=fndef-content >Note that <code>⊑</code> in Julia&#39;s type inference &quot;corresponds&quot; to <code>≥</code> in our constant folding prop&#39; setup, since they work on their lattice in the opposite direction.
    
</table>
<table class=fndef  id="fndef:8">
    <tr>
        <td class=fndef-backref ><a href="#fnref:8">[8]</a>
        <td class=fndef-content >Again, Julia&#39;s type inference transitions abstract value from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊥</mi></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊥</span></span></span></span> to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >⊤</mi></mrow><annotation encoding="application/x-tex">\top</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class=mord >⊤</span></span></span></span> as opposed to our constant folding prop&#39; setup, and so it should update abstract value using <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊔</mo></mrow><annotation encoding="application/x-tex">\sqcup</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.55556em;vertical-align:0em;"></span><span class=mord >⊔</span></span></span></span>, which is the counterpart operation of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊓</mo></mrow><annotation encoding="application/x-tex">\sqcap</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.55556em;vertical-align:0em;"></span><span class=mord >⊓</span></span></span></span>.
    
</table>
</p>
<p></p>
<div class=page-foot >
  <div class=copyright >
    &copy; Shuhei Kadowaki. Last modified: 2020-11-10. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
     


 
     

 

    
    <script src="/libs/collapsible.js"></script>
<script src="/libs/lodash.js"></script>
<script src="/libs/onscroll.js"></script>


    
    
    <script>
      document.ontouchstart = () => {}
    </script>